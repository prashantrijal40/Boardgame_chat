{% extends "base.html" %}

{% block content %}
  <div class="mb-4">
    <h2>â¤ï¸ Your Favorite Links</h2>
  </div>

  {% if links %}
    {% for link in links %}
      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h5 class="card-title">
            <a href="#" class="text-decoration-none">{{ link.title }}</a>
          </h5>
          <p class="card-text">{{ link.description }}</p>
          <p class="text-muted small">
            Posted by: {{ link.author.username }} ({{ link.author.boardgame_points }} points)<br>
            Submitted on {{ link.timestamp.strftime('%Y-%m-%d') }}
          </p>
          <div class="d-flex justify-content-between align-items-center">
            <div><strong>Rating:</strong> {{ link.aggregate_rating() }}</div>
            <div class="btn-group btn-group-sm">
              <a href="{{ url_for('main.rate_link', link_id=link.id, value=1) }}" class="btn btn-success">ğŸ‘</a>
              <a href="{{ url_for('main.rate_link', link_id=link.id, value=-1) }}" class="btn btn-danger">ğŸ‘</a>
              {% if current_user == link.author %}
                <a href="{{ url_for('main.edit_link', link_id=link.id) }}" class="btn btn-outline-primary">âœï¸ Edit</a>
                <a href="{{ url_for('main.delete_link', link_id=link.id) }}" class="btn btn-outline-danger" onclick="return confirm('Are you sure you want to delete this link?');">ğŸ—‘ï¸ Delete</a>


              {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>You haven't marked any links as favorites yet.</p>
  {% endif %}
{% endblock %}

{% block scripts %}
<script>
  function hideLink(linkId) {
    fetch(`/api/hide_link/${linkId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(res => {
      if (res.ok) {
        alert("Link hidden successfully.");
        location.reload();
      } else {
        alert("Failed to hide link.");
      }
    });
  }
</script>
{% endblock %}
